name: PHPStan Auto-Fix (Reusable Action)

on:
  workflow_run:
    workflows: ["PHPStan"]
    types:
      - completed

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  auto-fix-phpstan:
    if: ${{ github.event.workflow_run.conclusion == 'failure' }}
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v5
        with:
          ref: ${{ github.event.workflow_run.head_branch }}
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Run PHPStan Auto-Fix
        uses: ./.github/actions/phpstan-auto-fix
        with:
          php-version: '8.4'
          memory-limit: '512M'
          assignee: 'baspa'
          labels: 'bug,phpstan,auto-generated,ci'
